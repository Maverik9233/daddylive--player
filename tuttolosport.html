<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MultiPlayer - Tutto lo sport</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.js"></script>

<style>
body { background:#000; color:#fff; font-family:Arial; margin:0; text-align:center; }
h1 { margin:20px 0; color:#0bf; }
#brandLogo { width:200px; margin:10px auto; display:block; }

/* Bottoni JSON / Serie / Stagione */
.button-bar { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin:10px 0; }
.button-bar button { padding:10px 15px; background:#111; color:#0bf; border:2px solid #0bf; border-radius:10px; cursor:pointer; font-size:14px; transition:0.2s; }
.button-bar button:hover, .button-bar button.active { background:#0bf; color:#000; }

#selectedLogo { width:160px; margin:10px auto; border-radius:12px; display:block; }

/* Griglia Episodi */
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:15px; padding:20px; max-width:1000px; margin:auto; }
.channel { background:linear-gradient(135deg,#0a0a0a,#111,#000); border-radius:14px; padding:12px; cursor:pointer; transition:0.25s; border:2px solid transparent; }
.channel:hover { transform:scale(1.06); border-color:#0bf; box-shadow:0 0 15px #0bf; }
.channel img { width:100%; border-radius:10px; object-fit:contain; height:100px; background:#000; }
.channel-name {
  font-size:14px;
  margin-top:8px;
  color:#fff;
  white-space: normal; /* Linee multiple per vedere tutto il testo */
  overflow: visible;
  text-overflow: clip;
}
.active-episode { outline:3px solid rgba(11,191,255,0.12); box-shadow:0 6px 22px rgba(11,191,255,0.12); }

/* Player */
.player-container { position:relative; width:90%; max-width:900px; margin:20px auto; padding-top:56.25%; }
video, iframe { position:absolute; top:0; left:0; width:100%; height:100%; border-radius:10px; background:#000; display:none; }
</style>
</head>
<body>

<img id="brandLogo" src="" alt="">
<h1>MultiPlayer - Tutto lo sport</h1>

<!-- Bottoni JSON -->
<div id="jsonButtons" class="button-bar"></div>

<!-- Bottoni Serie -->
<div id="seriesButtons" class="button-bar"></div>

<!-- Bottoni Stagioni -->
<div id="seasonButtons" class="button-bar"></div>

<img id="selectedLogo" src="https://via.placeholder.com/160x90?text=Logo" alt="Logo">

<div id="episodeGrid" class="grid"></div>

<div class="player-container">
  <video id="video" controls autoplay playsinline></video>
  <iframe id="iframePlayer" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<script>
const jsonButtons = document.getElementById("jsonButtons");
const seriesButtons = document.getElementById("seriesButtons");
const seasonButtons = document.getElementById("seasonButtons");
const episodeGrid = document.getElementById("episodeGrid");
const video = document.getElementById("video");
const iframe = document.getElementById("iframePlayer");
const selectedLogo = document.getElementById("selectedLogo");

let loadedData = [];
let currentData = null;
let currentSeries = null;
let currentSeason = null;
let currentActiveEpisode = null;

// Lista JSON da caricare
const jsonURLs = [
  "https://raw.githubusercontent.com/Maverik9233/daddylive--player/refs/heads/main/skysportchannels.json",
  "https://raw.githubusercontent.com/Maverik9233/daddylive--player/refs/heads/main/hattrick.json",
  ""// puoi aggiungere altri URL qui
];

// --- Funzioni Player ---
function resetPlayers() {
  try { video.pause(); video.removeAttribute('src'); video.load(); } catch(e){}
  iframe.src = '';
  video.style.display = 'none';
  iframe.style.display = 'none';
}

function playIframe(url){
  resetPlayers();
  iframe.src = url;
  iframe.style.display = "block";
}

function playHLS(url){
  resetPlayers();
  if(Hls.isSupported()){
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, ()=>{
      video.style.display="block";
      video.play().catch(()=>{});
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src = url;
    video.style.display="block";
    video.play().catch(()=>{});
  } else playIframe(url);
}

async function playMPD(url){
  resetPlayers();
  try {
    shaka.polyfill.installAll();
    const player = new shaka.Player(video);
    await player.load(url);
    video.style.display="block";
    video.play().catch(()=>{});
  } catch(e){
    playIframe(url);
  }
}

function loadStream(urls){
  if(!Array.isArray(urls)) urls=[urls];
  for(const url of urls){
    const u = url.toLowerCase();
    if(u.endsWith('.m3u8')) return playHLS(url);
    if(u.endsWith('.mpd')) return playMPD(url);
    if(u.includes('/embed/') || u.includes('.php')) return playIframe(url);
    if(url.match(/\.(mp4|webm|mkv)$/i)){
      resetPlayers();
      video.src = url;
      video.style.display="block";
      video.play().catch(()=>{});
      return;
    }
  }
  playIframe(urls[0]);
}

// --- Creazione Bottoni JSON ---
function createJSONButtons() {
  jsonButtons.innerHTML = '';
  jsonURLs.forEach((url, index)=>{
    const btn = document.createElement('button');
    btn.textContent = `Lista ${index+1}`;
    btn.onclick = ()=> loadJSON(url);
    jsonButtons.appendChild(btn);
  });
}

// --- Caricamento JSON remoto ---
async function loadJSON(url){
  try {
    const res = await fetch(url);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    loadedData = Object.entries(data).map(([name, seasons])=>({name,seasons})); 
    currentData = loadedData;
    createSeriesButtons();
  } catch(e){
    console.error("Errore caricamento JSON:", e);
  }
}

// --- Serie ---
function createSeriesButtons() {
  seriesButtons.innerHTML = '';
  currentData.forEach(serie=>{
    const btn = document.createElement('button');
    btn.textContent = serie.name;
    btn.onclick = ()=>{
      currentSeries = serie;
      Array.from(seriesButtons.children).forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      createSeasonButtons();
    };
    seriesButtons.appendChild(btn);
  });
}

// --- Stagioni ---
function createSeasonButtons() {
  seasonButtons.innerHTML = '';
  if(!currentSeries) return;
  Object.keys(currentSeries.seasons).forEach(seasonName=>{
    const btn = document.createElement('button');
    btn.textContent = seasonName;
    btn.onclick = ()=>{
      currentSeason = currentSeries.seasons[seasonName];
      Array.from(seasonButtons.children).forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      loadEpisodes();
    };
    seasonButtons.appendChild(btn);
  });
}

// --- Carica Episodi ---
function loadEpisodes() {
  episodeGrid.innerHTML = '';
  if(!currentSeason) return;
  currentSeason.forEach(ep=>{
    const card = document.createElement("div");
    card.className = "channel";
    const img = ep.image || "https://via.placeholder.com/160x90?text=No+Logo";
    card.innerHTML = `<img src="${img}" alt=""><div class="channel-name">${ep.name}</div>`;
    card.onclick = ()=>{
      if(currentActiveEpisode) currentActiveEpisode.classList.remove("active-episode");
      card.classList.add("active-episode");
      currentActiveEpisode = card;
      selectedLogo.src = img;
      loadStream(ep.url);
    };
    episodeGrid.appendChild(card);
  });
}

// --- Inizializzazione ---
createJSONButtons();
</script>
</body>
</html>
